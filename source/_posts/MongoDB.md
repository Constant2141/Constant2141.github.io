---
title: Mongo
date: 2020-9-23 13:03:42
tags: [Mongo]
categories: 
- 后端
- db
cover: https://picsum.photos/seed/20200923/500/300
thumbnail: https://picsum.photos/seed/20200923/500/300
toc: true
---
介绍Mongo相比传统的关系型数据库具有的优点，然后介绍适合Mongo的应用场景。
<!-- more -->
### 何谓MongoDB

MongoDB是一款广受欢迎的文档型数据库，数据以BSON（一种类JSON的二进制形式）的格式存储

### 对比传统关系型DB优点

对比传统的关系型数据库，MongoDB有很多独有的优势，比如：

1. **schema-free，灵活易用的文档模型**
2. **原生分布式支持带来良好的扩展性，支持海量数据的存储**
3. 强大的索引支持，支持多种索引类型，如TTL、文本、地理位置等等
4. JSON 格式存储最接近真实对象模型，对开发者友好，方便快速开发迭代

### 应用场景

游戏、UGC、电商、物联网、直播等，支撑了很多核心的业务数据存储

#### UGC

用户生成内容

+ 数据由用户产生，结构多变

  数据结构可能是非结构化的，传统关系型数据库需要事先定义好表结构，无法适应这种场景，就算可以支持，增删字段也是麻烦的，MongoDB没有表结构

+ 海量数据存储

  如今单个应用的数据存储已经可以达到TB，甚至PB级别，MongoDB天然支持分布式部署，通过分片集群，将数据分布到不同分片，实现海量存储

+ 需要二级索引，按照多个维度查询展示

  MongoDB支持多种索引类型，可以对各个字段建立二级索引，能够高效的对各个维度进行查询展示

+ 性能、可用性、数据安全的一个综合考虑

  多副本保证数据安全，完善的故障恢复机制，灵活的数据一致性读写接口

#### 游戏

+ 对复杂结构友好（支持Document，自由模式）

  游戏的迭代速度很快，装备、属性等字段变更非常频繁，且玩家数据存在频繁的联动与刷新，数据结构极其复杂。使用 MongoDB 存储游戏用户信息、装备、积分等时，会直接以内嵌**文档**的形式存储，**无需进行复杂的模式设计**。
  得益于MongoDB的BSON的文档存储模型，MongoDB具备了**多形性**和**动态性**，多形性表示同一个集合包含不同字段的文档对象，这意味着插入一条数据结构更新后的记录，动态性意味着动态增加、修改字段无需停止数据库服务。这种no-schema模式大大免去了变更表结构的痛苦，大幅度缩短游戏版本的迭代周期。

+ 高性能（支持高可用）

  延迟高于几百毫秒之后玩家体验会急剧降低；且游戏业务的用户量存在明显的高低峰期。高峰期对数据库的并发能力和QPS有较高要求。

+ 可扩展性（支持Sharding，可扩展）

  随着游戏的发展，玩家数量越来越多，或者在某些运营活动的短时间内，用户量暴增。MongoDB本身支持副本集的纵向扩展，通过多个节点的方式，大大提升集群的读能力，通过分片集群的横向扩展，将数据通过片键存储在多台物理机上，实现存储容量线性快速扩展的目的

### 什么样的场景适合用MongoDB

1. 业务不是非得用到关系型数据库的一些特性（如事务、join等），大多数情况都可以选择MongoDB，当然MongoDB4.0也支持事务了

2. 业务没有固定的数据模型，数据格式变动频繁

3. 需要支持海量数据（TB、PB级别）存储

4. 对性能和延时有较高要求，例如ms级别

5. 游戏一般会考虑Mysql或tcaplus或MongoDB的其中一种，选用MongoDB的大都是代理类业务。一般还是用前两个多

   >游戏数据库（TcaplusDB）是腾讯自研的，专为游戏设计的**分布式非关系型**数据存储服务。