---
title: 多角度看待HTTPS
date: 2020-02-26 15:00:30
tag: [HTTP,网络]
categories: 
- 计算机
cover: https://picsum.photos/seed/20200226/500/300
thumbnail: https://picsum.photos/seed/20200226/500/300
toc: true
---
本文从HTTPS的作用、缺点、与HTTP的区别、加密算法、数字证书、SSL/TLS等角度介绍HTTPS的知识点
 <!--more-->
# 一、HTTPS介绍
## 1.作用
+ 内容加密 保证数据传输的安全；
+ 身份验证 确认网站的真实性；
+ 数据完整性 防止内容被第三方冒充或者篡改
## 2.缺点
+ 需要进行非对称的加解密，且需要三次握手。首次连接比较慢
+ 出于安全考虑，浏览器默认不会在本地对HTTPS缓存。Firefox默认只在内存中缓存HTTPS。但是，只要头命令中有Cache-Control: Public，缓存就会被写到硬盘上。IE只要http头允许就可以缓存https内容

## 3.和HTTP的区别
+ HTTP明文传输，而后者ssl加密，密文传输
+ 端口不一样，80and443
+ http的连接是无状态的(不验证通信双方)，Https可进行身份认证
+ https要到CA申请证书

## 4.HTTP无状态无连接
+ 无状态的意思是，协议没有记忆能力，对同一个url的请求没有上下文关系，每个请求都是独立的。后来出现了cookie

+ 无连接的含义是限制每次建立连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可尽快释放资源。后来网页复杂了，嵌入图片什么的，每次访问都要建立tcp连接太低效，就出现了keep-alive

![](https://upload-images.jianshu.io/upload_images/2223007-8fdca151b9f7c456?imageMogr2/auto-orient/strip|imageView2/2/w/640/format/webp)

# 二、相关技术
## 1. 对称加密
常见的有DES、AES、RC4
## 2. 非对称加密
 需要公钥私钥。常见算法有RSA。加密内容的长度有限制，不能超过公钥长度。
## 3. 摘要算法
 单向散列(hash)算法，常见MD5
## 4. 数字签名
非对称加密和数字摘要的结合应用。明文 ——> hash算法 ——> 摘要 ——> 私钥加密 ——> 数字签名
> 数字签名只能验证数据的完整性和身份验证，数据本身是否加密不属于数字签名的控制范围
## 5. 数字证书
### 1） 数字证书的作用
对请求方来说，要用公钥解密发送方发过来的证书里面的摘要，这个公钥怎么保证就是对方的呢？就要借助权威的值得信赖的第三方机构CA(证书颁发机构)
### 2） 颁发证书过程
用户首先产生自己的密钥对，并将公钥及部分个人身份信息传送给认证中心。认证中心在核实身份后，将执行一些必要的步骤，以确信请求确实由用户发送而来，然后认证中心将发给用户一个数字证书。
### 3） 证书包含内容
+ 证书颁发机构的名称
+ 证书本身的数字签名
+ 证书持有者公钥
+ 证书签名用到的Hash算法
### 4）怎么验证证书有效
前提：浏览器默认都会内置CA根证书，根证书包含了CA的公钥

1. 验证证书颁发的机构是否存在，浏览器不认识，直接认为是危险证书
2. 存在的话根据CA名，找到对应内置的CA根证书。用证书里面的公钥，对摘要解密，不行表现危险证书
3. 解密得到摘要A，然后再根据证书提供的的HASH算法计算出证书的摘要B，对比A与B，若相等则正常，否则就是被篡改过的。
4. 证书可在其过期前被手动吊销，目前较新的浏览器如Chrome、Firefox、Opera和Internet Explorer都实现了在线证书状态协议（OCSP）以避免这种情况：浏览器将目标网站提供的证书的序列号通过OCSP发送给证书颁发机构，后者会告诉浏览器证书是否还是有效的。


# 三、SSL与TLS
TLS建立在SSL 3.0协议规范之上，分为记录协议和握手协议

## TLS比SSL优势
1. 消息认证使用密钥散列法更安全：TLS使用“消息认证代码的密钥散列法”（HMAC），SSL3.0使用的是键控消息认证（MAC），HMAC比MAC功能更安全。
2. 伪随机功能增强（PRF）：PRF生成密钥数据(那三个随机数)。在TLS中，PRF使用两种散列算法保证其安全性。
3. 已完成消息验证改进。TLS将此已完成消息基于PRF和HMAC值之上，
4. 一致证书处理。与SSLv3.0不同，TLS试图指定必须在TLS之间实现交换的证书类型。

## 握手过程
![](https://upload-images.jianshu.io/upload_images/2223007-7989d1139ca847c9?imageMogr2/auto-orient/strip|imageView2/2/w/640/format/webp)

## 恢复会话
1. session ID。每一次对话都有一个编号。如果对话中断，下次重连的时候，只要客户端给出这个编号，且服务器有这个编号的记录，双方就可以重新使用已有的“对话密钥”，而不必重新生成一把。
> session ID是目前所有浏览器都支持的方法，缺点在于session ID往往只保留在一台服务器上。所以，如果客户端的请求发送到另一台服务器，就无法恢复对话。

2. session ticket。 上一次对话中发送过来的session ticket。这个session ticket是加密的，只有服务器才能解密，包含了对话密钥和加密方法。恢复会话的时候。当服务器收到session ticket以后，如果可以解密，就不必重新生成对话密钥了。
> 目前只有Firefox和Chrome浏览器支持。