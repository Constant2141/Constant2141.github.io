---
title: 小程序初体验
date: 2019-03-29 15:30:35
tags: [小程序]
categories: 
- 前端
- 小程序
cover: https://picsum.photos/seed/20190329/500/300
thumbnail: https://picsum.photos/seed/20190329/500/300
toc: true
---
#### 小程序版本分为 
预览版本 开发版本 体验版本 审核版本 线上版本


#### js在不同地方的构成
浏览器是 ECMAScript NPM DOM BOM
NodeJS中 ECMAScript NPM Native
小程序中 ECMAScript 小程序框架 小程序API


#### App构造器的参数
```js
App({
  onLaunch: function(options) {},
  onShow: function(options) {},
  onHide: function() {},
  onError: function(msg) {},
  globalData: 'I am global data'
})
```


![image](C3E1CAB28658419DB22CBB686B380E11)

场景值	 | 场景 |appId信息含义
---|---|---
1020| profile|页相关小程序列表 返回来源公众号 appId
1035|公众号自定义菜单|返回来源公众号appId
1036| App 分享消息卡片 |	返回来源应用appId
1037|	小程序打开小程序|	返回来源小程序 appId
1038|	从另一个小程序返回|	返回来源小程序 appId
1043|	公众号模板消息|	返回来源公众号 appId

#### 全局数据
```js
// app.js
App({
  globalData: 'I am global data' // 全局共享数据
})
// 其他页面脚本other.js
var appInstance = getApp()
console.log(appInstance.globalData) // 输出: I am global data
```
所有页面的脚本逻辑都跑在同一个JsCore线程，页面使用setTimeout或者setInterval的定时器，然后跳转到其他页面时，这些定时器并没有被清除，需要开发者自己在页面离开的时候进行清理。


#### 生命周期
>页面初次加载的时候，微信客户端就会给Page实例派发onLoad事件，Page构造器参数所定义的onLoad方法会被调用，onLoad在页面没被销毁之前只会触发1次，在onLoad的回调中，可以获取当前页面所调用的打开参数option，关于打开参数我们放在这一节的最后再展开阐述。
页面显示之后，Page构造器参数所定义的onShow方法会被调用，一般从别的页面返回到当前页面时，当前页的onShow方法都会被调用。
在页面初次渲染完成时，Page构造器参数所定义的onReady方法会被调用，onReady在页面没被销毁前只会触发1次，onReady触发时，表示页面已经准备妥当，在逻辑层就可以和视图层进行交互了。
以上三个事件触发的时机是onLoad早于 onShow，onShow早于onReady
页面不可见时，Page构造器参数所定义的onHide方法会被调用，这种情况会在使用wx.navigateTo切换到其他页面、底部tab切换时触发。
当前页面使用wx.redirectTo或wx.navigateBack返回到其他页时，当前页面会被微信客户端销毁回收，此时Page构造器参数所定义的onUnload方法会被调用。


#### 打开参数
页面Page构造器里onLoad的option可以拿到当前页面的打开参数，其类型是一个Object，其键值对与页面URL上query键值对一一对应

####  常见的事件类型
类型|触发条件|
---|---
touchstart	|手指触摸动作开始
touchmove	|手指触摸后移动
touchcancel	|手指触摸动作被打断，如来电提醒，弹窗
touchend	|手指触摸动作结束
tap	|手指触摸后马上离开
longpress	|手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发
longtap	|手指触摸后，超过350ms再离开（推荐使用longpress事件代替）
transitionend	|会在 WXSS transition 或 wx.createAnimation 动画结束后触发
animationstart	|会在一个 WXSS animation 动画开始时触发
animationiteration	|会在一个 WXSS animation 一次迭代结束时触发
animationend	|会在一个 WXSS animation 动画完成时触发


