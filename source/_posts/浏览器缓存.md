---
title: 浏览器缓存
date: 2019-09-06 21:02:30
tags: [http]
categories:
- 前端
- 浏览器
cover: https://picsum.photos/seed/20190906/500/300
thumbnail: https://picsum.photos/seed/20190906/500/300
toc: true
---
浏览器缓存是一个很重要的知识点，下面从缓存的优先级、作用、强缓存与协商缓存的特性这几个角度介绍，后续考虑补充说明。
<!-- more -->
### 缓存的优先级
![image](11.png)


### 缓存的作用：
1. 减少延迟(页面打开的速度)。
2. 降低服务器负载(先取缓存，无缓存在请求服务器，有效降低服务器的负担)。
3. 保证稳定性(有个笑话是手机抢购时为了保证服务器的稳定性，在前端写个随机数限制百分之二十的人发送数据到后台，这也侧面说明了缓存对于稳定性的作用)。

### Expires
指定服务器返回的文件有效期，是一个指定日期(截止日期)，但是会受到本机系统时间影响，比如修改电脑时间到2111年，那么这个缓存就一定会过期了

### Last-Modified
指服务器文件的最后修改时间，浏览器会带上If-Modified-Since字段(注意在请求头中的字段是这个，响应头中的字段才是Last-Modified)向服务器发送请求，与服务器文件修改时间Last-Modified做对比，如果时间不同，则获取数据返回200，否则返回304后调用浏览器本地硬盘的缓存。

304状态码，简单的表达就是：服务端已经执行了GET，但文件未变化。

这种方式也有问题，如果服务端文件频繁修改保存，那么Last-Modified就会频繁更改，每次都从服务端获取，这也就有了http1.1的ETag出现

### Cache-Control
指文件缓存的有效期(持续时间)。

![image](22.png)

1. max-age:单位是s，设置文件最大缓存时间，用得最多。
2. public:缓存可以被多用户共享，例如360浏览器可以登录不同账号，电脑系统可以切换不同账号。
3. private:仅单用户私有，不被多用户共享。
4. no-cache:不会被缓存。
5. no-store:不允许被存储。


### ETag
![image](33.png)


http1.1推出，对应一个版本号，由服务端随机生成的，浏览器会带上If-None-Match字段向服务器发送请求，与服务器文件修改版本ETag做对比，如果版本号不同，则获取数据返回200，否则返回304后调用浏览器本地硬盘的缓存，这种方式比Last-Modified靠谱。

### 其他知识点
1. 如果浏览器只支持http1.0，那么浏览器只会携带Last-Modified发送给后台
2. 如果服务器只支持http1.0，那么服务器会以Last-Modified为标准。
3. 如果浏览器支持http1.1，那么浏览器会携带Cache-Control+Last-Modified+ETag发送给后台
4. 如果服务器支持http1.1，那么服务器会以Cache-Control+ETag为标准。
